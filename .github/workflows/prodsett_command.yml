name: Manuell deploy
on:
  repository_dispatch:
    types: [prodsett-command]

jobs:
  deploy_manuelt:
    name: 'Build, push, and deploy'
    runs-on: ubuntu-latest
    steps:
      # LOGGER VARIABLE
      - name: 'PROD-GCP: Pull repo'
        uses: actions/checkout@v1
      - run: |
          echo "versjon: ${{ github.event.client_payload.slash_command.arg1 }}"
          echo "cluster: ${{ github.event.client_payload.slash_command.arg2 }}"
          echo "resource: ${{ github.event.client_payload.slash_command.arg2 }}.yml"
          echo "image: docker.pkg.github.com/${{ github.repository }}/eessi-pensjon-prefill:${{ github.event.client_payload.slash_command.arg1 }}"
      - if: (${{ github.event.client_payload.slash_command.arg2 }} == 'prod')

      # DEPLOYER TIL NAIS
      - name: 'PROD-GCP: Deploy to NAIS '
        uses: nais/deploy/actions/deploy@v1
        env:
          APIKEY: ${{ secrets.NAIS_DEPLOY_APIKEY }}
          CLUSTER: ${{ github.event.client_payload.slash_command.arg2 }}
          RESOURCE: nais/${{ github.event.client_payload.slash_command.arg2 }}.yml
          IMAGE: docker.pkg.github.com/${{ github.repository }}/eessi-pensjon-prefill:${{ github.event.client_payload.slash_command.arg1 }}
      - if: (${{ github.event.client_payload.slash_command.arg2 }} == 'prod')

      # LOGGER VARIABLE
      - name: 'DEV-GCP: Pull repo'
        uses: actions/checkout@v1
      - run: |
          echo "versjon: ${{ github.event.client_payload.slash_command.arg1 }}"
          echo "cluster: ${{ github.event.client_payload.slash_command.arg2 }}"
          echo "resource: ${{ github.event.client_payload.slash_command.arg2 }}-${{ github.event.client_payload.slash_command.arg3 }}.yml"
          echo "image: docker.pkg.github.com/${{ github.repository }}/eessi-pensjon-prefill:${{ github.event.client_payload.slash_command.arg1 }}"
      - if: (${{ github.event.client_payload.slash_command.arg2 }} == 'dev-gcp')

      # DEPLOYER TIL NAIS
      - name: 'DEV-GCP: Deploy to NAIS'
        uses: nais/deploy/actions/deploy@v1
        env:
          APIKEY: ${{ secrets.NAIS_DEPLOY_APIKEY }}
          CLUSTER: ${{ github.event.client_payload.slash_command.arg2 }}
          RESOURCE: nais/${{ github.event.client_payload.slash_command.arg2 }}-${{ github.event.client_payload.slash_command.arg3 }}.yml
          IMAGE: docker.pkg.github.com/${{ github.repository }}/eessi-pensjon-prefill:${{ github.event.client_payload.slash_command.arg1 }}
      - if: (${{ github.event.client_payload.slash_command.arg2 }} == 'dev-gcp')
